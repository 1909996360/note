<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端安全问题</title>
</head>
<body>
    <script>
        /*
            参考地址：https://mp.weixin.qq.com/s/yySaJWuYl4zp6MLtMCwyHQ

            1、XSS攻击(跨脚本攻击)
            2、CSRF(跨站请求伪造)
            3、中间人

            方法：
            4、接口加签
            5、接口加密
            6、接口防重放
            7、环境检测
            8、验证码
            9、代码加密混淆


            1、XSS
                跨脚本攻击的缩写，攻击者想尽一切方法，将一段脚本内容放到目标网站的目标浏览器上解释执行，攻击者将恶意脚本输入到目标网站中，当其他用户访问到该网站的时候，由于浏览器不知道他是由网站提供服务的脚本还是攻击埋入的脚本，因此将执行此该脚本。攻击者就可以很容易利用埋入的脚本进行攻击

                攻击步骤 
                    1、攻击者编写恶意攻击的脚本
                    2、攻击者访问前端页面，在输入框输入编写好的恶意脚本
                    3、攻击者将恶意脚本进行提交，后端将恶意脚本存储在数据库中
                    4、当某些合法用户访问该网站的时候，该网站会获取存储在数据库中的恶意脚本，但是浏览器不知他是恶意脚本所以执行了

                防范：
                    1、用户不要相信用户的输入，对用户输入的特殊字符进行转义，针对用户的输入设置标签白名单
                    2、cookie设置HttpOnly，配合token或验证码防范
                    3、设置CSP安全策略--可以通过两种方式设置CSP，一种是meta标签，一种是HTTP响应头Content-Security-Policy

            2、CSRF
                CSRF是跨站请求伪造的简写，一种诱骗受害者提交恶意请求的攻击，攻击者盗用了你的身份，以你的名义发送恶意请求，请求到达后端时，服务器将无法区分恶意请求和合法请求。CSRF能够做的事情包括：以你的名义发送邮件，发消息，盗取你的账号，甚至购买商品，虚拟货币转账等

                攻击步骤
                    1、登录受信任网站A，并在本地生成Cookie
                    2、在不登出A的情况下，访问危险网站B

                防范：
                    1、同源检测，直接禁止外域（受信域可以开白名单）对我们发起请求
                    2、CSRF Token，就把Token以参数的形式加入请求了，提交给服务器的时候，服务器需要判断Token的有效性
                    3、Samesit Cookie属性，Samesite=Strict 只允许同源网站提交请求携带cookie

            3、网络传输安全
                中间人使指攻击者与通讯的两端分别创建独立的联系，并交换其所收到的数据，使通讯的两端认为他们正在通过一个私密的连接与对方直接对话，但事实上整个会话都被攻击者完全控制，在中间人攻击中，攻击者可以拦截通讯双方的通话并插入新的内容。
                是不是觉得有了HTTPS网络传输安全问题就迎刃而解了呢，即使被中间人拦截了，数据也是加密的，不然

                charles抓包工具，

                防范：
                    1、对于个人来说防止被中间人攻击最基本的就是不要乱连不安全的网络
                    2、公司APP来说应该配置禁止被抓包
                    3、APP和浏览器都应该严格校验证书，不使用不安全的APP和浏览器

            4、接口加签
                通过上面的例子我们知道https并不是绝对安全的，他是会被中间人劫持的，那么我们有什么方法防止数据被篡改呢？
                接口加签的目的时防止数据被篡改

                为了防止中间人数据篡改的方式，引入接口加签

                服务端网关首先会校验签是不是对的，如果不对直接拒绝请求，而签的生成和请求参数密密相关，当接口请求中的参数被篡改后，网关时没法进行验签通过的，直接拒绝了请求，抛出错误

            5、接口加密
                有时候我们的参数根本不想被人看见是啥，我们就可以利用参数加密了

            6、接口防重放
                防重放也叫防复用，简单来说，就是我获取到这个请求的信息之后，我什么也不改，我就拿着接口的参数去重复请求这个充值的接口，也就是说我的请求是合法的，因为所有参数都是跟合法请求一摸一样的。也就是说：服务端的sign验证一定能通过。如图上的例子，即使我们不知道登录账号名密码，即使接口参数被加签加密了，我们依然能够登录并拿到登录信息，我们根本不用关心加密加签的逻辑，我们只需要简单的重放攻击即可

                防重放设计
                    1、客户端在请求中添加两个参数
                        1.1、添加一个随机不重复的字符串参数，比如uuid，至于怎么让他不重复，可以考虑拼接时间戳，md5等
                        1.2、添加一个请求时间的参数，如time值就是发送请求时的时间戳
                    2、服务端接收到请求之后：
                        2.1、去缓存中查找uuid这个参数对应的值是否存在
                        2.2、如果不存在，就把这个uuid的值保存到缓存中，记录这个请求
                        2.3、如果已存在，存在那就证明，已经请求过一次了，就不处理这个请求了
                        
                这就是简单的防重放逻辑，接口只能调用一次，即使被中间人攻击后也没办法进行重放

            7、环境检测
                验证当前环境是不是浏览器

            8、验证码
        */ 
    </script>
</body>
</html>